apiVersion: backup.appuio.ch/v1alpha1
kind: Schedule
metadata:
  name: {{ include "k8up-schedule.fullname" . }}
  labels:
    {{- include "k8up-schedule.labels" . | nindent 4 }}
  annotations:
    {{- include "k8up-schedule.annotations" . | nindent 4 }}
spec:
  backend:
    repoPasswordSecretRef:
      key: repo-pw
      name: baas-repo-pw
    s3:
    {{- if .Values.bucket }}
      bucket: {{ .Values.bucket | quote }}
    {{- else }}
      bucket: baas-{{ .Values.project }}-{{ derivePassword 1 "short" .Values.projectSecret .Values.project .Values.project }}
    {{- end }}
  backup:
    schedule: '{{ .Values.backup.schedule }}'
  check:
    schedule: '{{ .Values.check.schedule }}'
  prune:
    retention:
      keepDaily: 7
      keepWeekly: 6
    schedule: '{{ .Values.prune.schedule }}'
