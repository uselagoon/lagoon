- name: "Add project {{ project }} to openshift {{ openshift }}"
  block:
    - include: admin-token.yaml
    - name: "Add project {{ project }} to openshift {{ openshift }}"
      uri:
        url: "{{ graphql_url }}"
        method: POST
        headers:
          Authorization: "Bearer {{ admin_token }}"
        body_format: json
        body:
          query: '{{ lookup("template", "./add-project.gql") }}'
      register: apiresponse
      until: api.response.status == 200
      retries: 10
      delay: "{{ 30 | random(start=15, step=5) }}"
    - name: "Add project {{ project }} to openshift {{ openshift }}"
      debug:
        msg: "api response: {{ apiresponse.json }}"
#      until: apiresponse.json.data.addProject.id > 0
      retries: 10
      delay: 30
