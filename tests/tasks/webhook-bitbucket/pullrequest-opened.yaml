- name: "{{ testname }} - POST gitlab pull request open webhook with pr number {{ git_pr_number }}, git base branch {{ git_base_branch }}, pr branch {{ git_pr_branch }}, pr commit hash {{ git_pr_commit_hash }} and repo {{ git_repo_ssh_url }} to {{ lookup('env','WEBHOOK_PROTOCOL') }}://{{ lookup('env','WEBHOOK_HOST') }}:{{ lookup('env','WEBHOOK_PORT') }}"
  uri:
    url: "{{ lookup('env','WEBHOOK_PROTOCOL') }}://{{ lookup('env','WEBHOOK_HOST') }}:{{ lookup('env','WEBHOOK_PORT') }}"
    headers:
      X-Event-Key: pullrequest:created
      content-type: application/json
    method: POST
    follow_redirects: yes
    body_format: json
    body: '{ "pullrequest": { "merge_commit": null, "description": "", "links": { "decline": { "href": "https://api.bitbucket.org/2.0/repositories/rtprio/ci-bitbucket/pullrequests/2/decline" }, "commits": { "href": "https://api.bitbucket.org/2.0/repositories/rtprio/ci-bitbucket/pullrequests/2/commits" }, "self": { "href": "https://api.bitbucket.org/2.0/repositories/rtprio/ci-bitbucket/pullrequests/2" }, "comments": { "href": "https://api.bitbucket.org/2.0/repositories/rtprio/ci-bitbucket/pullrequests/2/comments" }, "merge": { "href": "https://api.bitbucket.org/2.0/repositories/rtprio/ci-bitbucket/pullrequests/2/merge" }, "html": { "href": "https://bitbucket.org/rtprio/ci-bitbucket/pull-requests/2" }, "activity": { "href": "https://api.bitbucket.org/2.0/repositories/rtprio/ci-bitbucket/pullrequests/2/activity" }, "diff": { "href": "https://api.bitbucket.org/2.0/repositories/rtprio/ci-bitbucket/pullrequests/2/diff" }, "approve": { "href": "https://api.bitbucket.org/2.0/repositories/rtprio/ci-bitbucket/pullrequests/2/approve" }, "statuses": { "href": "https://api.bitbucket.org/2.0/repositories/rtprio/ci-bitbucket/pullrequests/2/statuses" } }, "title": "new pull request", "close_source_branch": false, "reviewers": [], "destination": { "commit": { "hash": "60d8a1b9f64a", "links": { "self": { "href": "https://api.bitbucket.org/2.0/repositories/rtprio/ci-bitbucket/commit/60d8a1b9f64a" } } }, "branch": { "name": "master" }, "repository": { "full_name": "git/ci-bitbucket", "type": "repository", "name": "ci-bitbucket", "links": { "self": { "href": "https://192.168.99.1:2222/2.0/repositories/git/ci-bitbucket" }, "html": { "href": "https://bitbucket.org/rtprio/ci-bitbucket" }, "avatar": { "href": "https://bytebucket.org/ravatar/%7B24411c7b-cb68-4d50-9a2d-969dda2e1464%7D?ts=default" } }, "uuid": "{24411c7b-cb68-4d50-9a2d-969dda2e1464}" } }, "comment_count": 0, "closed_by": null, "source": { "commit": { "hash": "d690dfc0e7c7", "links": { "self": { "href": "https://api.bitbucket.org/2.0/repositories/rtprio/ci-bitbucket/commit/d690dfc0e7c7" } } }, "branch": { "name": "pull-request" }, "repository": { "full_name": "rtprio/ci-bitbucket", "type": "repository", "name": "ci-bitbucket", "links": { "self": { "href": "https://api.bitbucket.org/2.0/repositories/rtprio/ci-bitbucket" }, "html": { "href": "https://bitbucket.org/rtprio/ci-bitbucket" }, "avatar": { "href": "https://bytebucket.org/ravatar/%7B24411c7b-cb68-4d50-9a2d-969dda2e1464%7D?ts=default" } }, "uuid": "{24411c7b-cb68-4d50-9a2d-969dda2e1464}" } }, "created_on": "2018-07-27T18:18:39.856770+00:00", "state": "OPEN", "task_count": 0, "participants": [], "reason": "", "updated_on": "2018-07-27T18:18:39.898027+00:00", "author": { "username": "rtprio", "display_name": "Elliot Schlegelmilch", "account_id": "557058:1376beb4-2683-49a8-9dc6-924faebb2666", "links": { "self": { "href": "https://api.bitbucket.org/2.0/users/rtprio" }, "html": { "href": "https://bitbucket.org/rtprio/" }, "avatar": { "href": "https://bitbucket.org/account/rtprio/avatar/" } }, "type": "user", "uuid": "{e21dc300-390c-402c-ba6f-37d9f152729c}" }, "summary": { "raw": "", "markup": "markdown", "html": "", "type": "rendered" }, "type": "pullrequest", "id": 2 }, "actor": { "username": "rtprio", "display_name": "Elliot Schlegelmilch", "account_id": "557058:1376beb4-2683-49a8-9dc6-924faebb2666", "links": { "self": { "href": "https://api.bitbucket.org/2.0/users/rtprio" }, "html": { "href": "https://bitbucket.org/rtprio/" }, "avatar": { "href": "https://bitbucket.org/account/rtprio/avatar/" } }, "type": "user", "uuid": "{e21dc300-390c-402c-ba6f-37d9f152729c}" }, "repository": { "scm": "git", "website": "", "name": "ci-bitbucket", "links": { "self": { "href": "https://api.bitbucket.org/2.0/repositories/rtprio/ci-bitbucket" }, "html": { "href": "https://192.168.99.1:2222/2.0/repositories/git/ci-bitbucket" }, "avatar": { "href": "https://bytebucket.org/ravatar/%7B24411c7b-cb68-4d50-9a2d-969dda2e1464%7D?ts=default" } }, "full_name": "rtprio/ci-bitbucket", "owner": { "username": "rtprio", "display_name": "Elliot Schlegelmilch", "account_id": "557058:1376beb4-2683-49a8-9dc6-924faebb2666", "links": { "self": { "href": "https://api.bitbucket.org/2.0/users/rtprio" }, "html": { "href": "https://bitbucket.org/rtprio/" }, "avatar": { "href": "https://bitbucket.org/account/rtprio/avatar/" } }, "type": "user", "uuid": "{e21dc300-390c-402c-ba6f-37d9f152729c}" }, "type": "repository", "is_private": true, "uuid": "{24411c7b-cb68-4d50-9a2d-969dda2e1464}" } }'
