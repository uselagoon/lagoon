- name: "{{ testname }} - POST bitbucket pull request closed webhook with pr number {{ git_pr_number }} repo {{ git_repo_ssh_url }} to {{ lookup('env','WEBHOOK_PROTOCOL') }}://{{ lookup('env','WEBHOOK_HOST') }}:{{ lookup('env','WEBHOOK_PORT') }}"
  uri:
    url: "{{ lookup('env','WEBHOOK_PROTOCOL') }}://{{ lookup('env','WEBHOOK_HOST') }}:{{ lookup('env','WEBHOOK_PORT') }}"
    headers:
      X-Event-Key: pullrequest:fulfilled
      content-type: application/json
    method: POST
    follow_redirects: yes
    body_format: json
    body: '{"pullrequest":{"merge_commit":{"hash":"e6a418ba5568","links":{"self":{"href":"https://api.bitbucket.org/2.0/repositories/rtprio/testrepo/commit/e6a418ba5568"}}},"description":"","links":{"decline":{"href":"https://api.bitbucket.org/2.0/repositories/rtprio/testrepo/pullrequests/2/decline"},"commits":{"href":"https://api.bitbucket.org/2.0/repositories/rtprio/testrepo/pullrequests/2/commits"},"self":{"href":"https://api.bitbucket.org/2.0/repositories/rtprio/testrepo/pullrequests/2"},"comments":{"href":"https://api.bitbucket.org/2.0/repositories/rtprio/testrepo/pullrequests/2/comments"},"merge":{"href":"https://api.bitbucket.org/2.0/repositories/rtprio/testrepo/pullrequests/2/merge"},"html":{"href":"https://bitbucket.org/git/bitbucket"},"activity":{"href":"https://api.bitbucket.org/2.0/repositories/rtprio/testrepo/pullrequests/2/activity"},"diff":{"href":"https://api.bitbucket.org/2.0/repositories/rtprio/testrepo/pullrequests/2/diff"},"approve":{"href":"https://api.bitbucket.org/2.0/repositories/rtprio/testrepo/pullrequests/2/approve"},"statuses":{"href":"https://api.bitbucket.org/2.0/repositories/rtprio/testrepo/pullrequests/2/statuses"}},"title":"new pull request","close_source_branch":false,"reviewers":[],"destination":{"commit":{"hash":"3dadce7","links":{"self":{"href":"https://api.bitbucket.org/2.0/repositories/rtprio/testrepo/commit/60d8a1b9f64a"}}},"branch":{"name":"master"},"repository":{"full_name":"rtprio/testrepo","type":"repository","name":"testrepo","links":{"self":{"href":"https://172.17.0.1:2222/2.0/repositories/git/bitbucket"},"html":{"href":"https://172.17.0.1:2222/2.0/repositories/git/bitbucket"},"avatar":{"href":"https://bytebucket.org/ravatar/%7B24411c7b-cb68-4d50-9a2d-969dda2e1464%7D?ts=default"}},"uuid":"{24411c7b-cb68-4d50-9a2d-969dda2e1464}"}},"comment_count":0,"closed_by":{"username":"rtprio","display_name":"lagoon user","account_id":"557058:1376beb4-2683-49a8-9dc6-924faebb2666","links":{"self":{"href":"https://api.bitbucket.org/2.0/users/rtprio"},"html":{"href":"https://bitbucket.org/git/bitbucket"},"avatar":{"href":"https://bitbucket.org/account/rtprio/avatar/"}},"type":"user","uuid":"{e21dc300-390c-402c-ba6f-37d9f152729c}"},"source":{"commit":{"hash":"658824d","links":{"self":{"href":"https://api.bitbucket.org/2.0/repositories/rtprio/testrepo/commit/d690dfc0e7c7"}}},"branch":{"name":"pull-request"},"repository":{"full_name":"rtprio/testrepo","type":"repository","name":"testrepo","links":{"self":{"href":"https://172.17.0.1:2222/2.0/repositories/git/bitbucket"},"html":{"href":"https://172.17.0.1:2222/2.0/repositories/git/bitbucket"},"avatar":{"href":"https://bytebucket.org/ravatar/%7B24411c7b-cb68-4d50-9a2d-969dda2e1464%7D?ts=default"}},"uuid":"{24411c7b-cb68-4d50-9a2d-969dda2e1464}"}},"created_on":"2018-07-27T18:18:39.856770+00:00","state":"MERGED","task_count":0,"participants":[],"reason":"","updated_on":"2018-07-27T20:29:56.934984+00:00","author":{"username":"rtprio","display_name":"lagoon user","account_id":"557058:1376beb4-2683-49a8-9dc6-924faebb2666","links":{"self":{"href":"https://api.bitbucket.org/2.0/users/rtprio"},"html":{"href":"https://bitbucket.org/git/bitbucket"},"avatar":{"href":"https://bitbucket.org/account/rtprio/avatar/"}},"type":"user","uuid":"{e21dc300-390c-402c-ba6f-37d9f152729c}"},"summary":{"raw":"","markup":"markdown","html":"","type":"rendered"},"type":"pullrequest","id":2},"actor":{"username":"rtprio","display_name":"lagoon user","account_id":"557058:1376beb4-2683-49a8-9dc6-924faebb2666","links":{"self":{"href":"https://api.bitbucket.org/2.0/users/rtprio"},"html":{"href":"https://bitbucket.org/git/bitbucket"},"avatar":{"href":"https://bitbucket.org/account/rtprio/avatar/"}},"type":"user","uuid":"{e21dc300-390c-402c-ba6f-37d9f152729c}"},"repository":{"scm":"git","website":"","name":"testrepo","links":{"self":{"href":"https://api.bitbucket.org/2.0/repositories/rtprio/testrepo"},"html":{"href":"https://172.17.0.1:2222/2.0/repositories/git/bitbucket"},"avatar":{"href":"https://bytebucket.org/ravatar/%7B24411c7b-cb68-4d50-9a2d-969dda2e1464%7D?ts=default"}},"full_name":"{{ git_repo_full_name }}","owner":{"username":"rtprio","display_name":"lagoon user","account_id":"557058:1376beb4-2683-49a8-9dc6-924faebb2666","links":{"self":{"href":"https://api.bitbucket.org/2.0/users/rtprio"},"html":{"href":"https://bitbucket.org/rtprio/"},"avatar":{"href":"https://bitbucket.org/account/rtprio/avatar/"}},"type":"user","uuid":"{e21dc300-390c-402c-ba6f-37d9f152729c}"},"type":"repository","is_private":true,"uuid":"{24411c7b-cb68-4d50-9a2d-969dda2e1464}"}}'
